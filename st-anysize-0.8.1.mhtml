From: <Saved by Blink>
Snapshot-Content-Location: https://st.suckless.org/patches/anysize/st-anysize-0.8.1.diff
Subject: 
Date: Sat, 22 Apr 2023 17:45:15 -0000
MIME-Version: 1.0
Content-Type: multipart/related;
	type="text/html";
	boundary="----MultipartBoundary--0Glpb2oiUhDll4CCzwCUM02zj9VLSoz061GGF0kWvB----"


------MultipartBoundary--0Glpb2oiUhDll4CCzwCUM02zj9VLSoz061GGF0kWvB----
Content-Type: text/html
Content-ID: <frame-34A6DEBE0C4891F7D6080406F4E2FB49@mhtml.blink>
Content-Transfer-Encoding: quoted-printable
Content-Location: https://st.suckless.org/patches/anysize/st-anysize-0.8.1.diff

<html><head><meta http-equiv=3D"Content-Type" content=3D"text/html; charset=
=3Dwindows-1252"><link rel=3D"stylesheet" type=3D"text/css" href=3D"cid:css=
-95512607-d3ac-425c-8f66-a3bb49aad7f6@mhtml.blink" /></head><body><pre styl=
e=3D"word-wrap: break-word; white-space: pre-wrap;">diff --git a/x.c b/x.c
index 00cb6b1..8f87c0f 100644
--- a/x.c
+++ b/x.c
@@ -78,6 +78,7 @@ typedef XftGlyphFontSpec GlyphFontSpec;
 typedef struct {
 	int tw, th; /* tty width and height */
 	int w, h; /* window width and height */
+	int hborderpx, vborderpx;
 	int ch; /* char height */
 	int cw; /* char width  */
 	int mode; /* window state/mode flags */
@@ -311,7 +312,7 @@ zoomreset(const Arg *arg)
 int
 evcol(XEvent *e)
 {
-	int x =3D e-&gt;xbutton.x - borderpx;
+	int x =3D e-&gt;xbutton.x - win.hborderpx;
 	LIMIT(x, 0, win.tw - 1);
 	return x / win.cw;
 }
@@ -319,7 +320,7 @@ evcol(XEvent *e)
 int
 evrow(XEvent *e)
 {
-	int y =3D e-&gt;xbutton.y - borderpx;
+	int y =3D e-&gt;xbutton.y - win.vborderpx;
 	LIMIT(y, 0, win.th - 1);
 	return y / win.ch;
 }
@@ -675,6 +676,9 @@ cresize(int width, int height)
 	col =3D MAX(1, col);
 	row =3D MAX(1, row);
=20
+	win.hborderpx =3D (win.w - col * win.cw) / 2;
+	win.vborderpx =3D (win.h - row * win.ch) / 2;
+
 	tresize(col, row);
 	xresize(col, row);
 	ttyresize(win.tw, win.th);
@@ -793,8 +797,8 @@ xhints(void)
 	sizeh-&gt;flags =3D PSize | PResizeInc | PBaseSize | PMinSize;
 	sizeh-&gt;height =3D win.h;
 	sizeh-&gt;width =3D win.w;
-	sizeh-&gt;height_inc =3D win.ch;
-	sizeh-&gt;width_inc =3D win.cw;
+	sizeh-&gt;height_inc =3D 1;
+	sizeh-&gt;width_inc =3D 1;
 	sizeh-&gt;base_height =3D 2 * borderpx;
 	sizeh-&gt;base_width =3D 2 * borderpx;
 	sizeh-&gt;min_height =3D win.ch + 2 * borderpx;
@@ -1022,8 +1026,8 @@ xinit(int cols, int rows)
 	xloadcols();
=20
 	/* adjust fixed window geometry */
-	win.w =3D 2 * borderpx + cols * win.cw;
-	win.h =3D 2 * borderpx + rows * win.ch;
+	win.w =3D 2 * win.hborderpx + cols * win.cw;
+	win.h =3D 2 * win.vborderpx + rows * win.ch;
 	if (xw.gm &amp; XNegative)
 		xw.l +=3D DisplayWidth(xw.dpy, xw.scr) - win.w - 2;
 	if (xw.gm &amp; YNegative)
@@ -1123,7 +1127,7 @@ xinit(int cols, int rows)
 int
 xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len,=
 int x, int y)
 {
-	float winx =3D borderpx + x * win.cw, winy =3D borderpx + y * win.ch, xp,=
 yp;
+	float winx =3D win.hborderpx + x * win.cw, winy =3D win.vborderpx + y * w=
in.ch, xp, yp;
 	ushort mode, prevmode =3D USHRT_MAX;
 	Font *font =3D &amp;dc.font;
 	int frcflags =3D FRC_NORMAL;
@@ -1259,7 +1263,7 @@ void
 xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, in=
t x, int y)
 {
 	int charlen =3D len * ((base.mode &amp; ATTR_WIDE) ? 2 : 1);
-	int winx =3D borderpx + x * win.cw, winy =3D borderpx + y * win.ch,
+	int winx =3D win.hborderpx + x * win.cw, winy =3D win.vborderpx + y * win=
.ch,
 	    width =3D charlen * win.cw;
 	Color *fg, *bg, *temp, revfg, revbg, truefg, truebg;
 	XRenderColor colfg, colbg;
@@ -1349,17 +1353,17 @@ xdrawglyphfontspecs(const XftGlyphFontSpec *specs, =
Glyph base, int len, int x, i
=20
 	/* Intelligent cleaning up of the borders. */
 	if (x =3D=3D 0) {
-		xclear(0, (y =3D=3D 0)? 0 : winy, borderpx,
+		xclear(0, (y =3D=3D 0)? 0 : winy, win.vborderpx,
 			winy + win.ch +
-			((winy + win.ch &gt;=3D borderpx + win.th)? win.h : 0));
+			((winy + win.ch &gt;=3D win.vborderpx + win.th)? win.h : 0));
 	}
-	if (winx + width &gt;=3D borderpx + win.tw) {
+	if (winx + width &gt;=3D win.hborderpx + win.tw) {
 		xclear(winx + width, (y =3D=3D 0)? 0 : winy, win.w,
-			((winy + win.ch &gt;=3D borderpx + win.th)? win.h : (winy + win.ch)));
+			((winy + win.ch &gt;=3D win.vborderpx + win.th)? win.h : (winy + win.ch=
)));
 	}
 	if (y =3D=3D 0)
-		xclear(winx, 0, winx + width, borderpx);
-	if (winy + win.ch &gt;=3D borderpx + win.th)
+		xclear(winx, 0, winx + width, win.hborderpx);
+	if (winy + win.ch &gt;=3D win.vborderpx + win.th)
 		xclear(winx, winy + win.ch, winx + width, win.h);
=20
 	/* Clean up the region we want to draw to. */
@@ -1452,35 +1456,35 @@ xdrawcursor(int cx, int cy, Glyph g, int ox, int oy=
, Glyph og)
 		case 3: /* Blinking Underline */
 		case 4: /* Steady Underline */
 			XftDrawRect(xw.draw, &amp;drawcol,
-					borderpx + cx * win.cw,
-					borderpx + (cy + 1) * win.ch - \
+					win.hborderpx + cx * win.cw,
+					win.vborderpx + (cy + 1) * win.ch - \
 						cursorthickness,
 					win.cw, cursorthickness);
 			break;
 		case 5: /* Blinking bar */
 		case 6: /* Steady bar */
 			XftDrawRect(xw.draw, &amp;drawcol,
-					borderpx + cx * win.cw,
-					borderpx + cy * win.ch,
+					win.hborderpx + cx * win.cw,
+					win.vborderpx + cy * win.ch,
 					cursorthickness, win.ch);
 			break;
 		}
 	} else {
 		XftDrawRect(xw.draw, &amp;drawcol,
-				borderpx + cx * win.cw,
-				borderpx + cy * win.ch,
+				win.hborderpx + cx * win.cw,
+				win.vborderpx + cy * win.ch,
 				win.cw - 1, 1);
 		XftDrawRect(xw.draw, &amp;drawcol,
-				borderpx + cx * win.cw,
-				borderpx + cy * win.ch,
+				win.hborderpx + cx * win.cw,
+				win.vborderpx + cy * win.ch,
 				1, win.ch - 1);
 		XftDrawRect(xw.draw, &amp;drawcol,
-				borderpx + (cx + 1) * win.cw - 1,
-				borderpx + cy * win.ch,
+				win.hborderpx + (cx + 1) * win.cw - 1,
+				win.vborderpx + cy * win.ch,
 				1, win.ch - 1);
 		XftDrawRect(xw.draw, &amp;drawcol,
-				borderpx + cx * win.cw,
-				borderpx + (cy + 1) * win.ch - 1,
+				win.hborderpx + cx * win.cw,
+				win.vborderpx + (cy + 1) * win.ch - 1,
 				win.cw, 1);
 	}
 }
</pre></body></html>
------MultipartBoundary--0Glpb2oiUhDll4CCzwCUM02zj9VLSoz061GGF0kWvB----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: cid:css-95512607-d3ac-425c-8f66-a3bb49aad7f6@mhtml.blink

@charset "utf-8";
=0A
------MultipartBoundary--0Glpb2oiUhDll4CCzwCUM02zj9VLSoz061GGF0kWvB------
